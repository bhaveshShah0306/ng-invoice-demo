<mat-card>
  <mat-card-header>
    <mat-card-title>
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <h2 style="margin: 0;">Bank Accounts</h2>
        <button mat-raised-button color="primary" (click)="createAccount()">
          <mat-icon>add</mat-icon>
          Create New Account
        </button>
      </div>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <!-- Search Filter -->
    <mat-form-field style="width: 100%; margin-bottom: 20px;">
      <mat-label>Search accounts</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Search by account number, name, email..." #input>
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    @if (loading$ | async) {
      <div style="display: flex; justify-content: center; padding: 40px;">
        <mat-spinner></mat-spinner>
      </div>
    } @else {
      <div class="mat-elevation-z8">
        <table mat-table [dataSource]="dataSource" matSort>
      
          <!-- Account Number Column -->
          <ng-container matColumnDef="accountNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Account Number </th>
            <td mat-cell *matCellDef="let row">
              <strong>{{ row.accountNumber }}</strong>
            </td>
          </ng-container>
      
          <!-- Account Holder Name Column -->
          <ng-container matColumnDef="accountHolderName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Account Holder </th>
            <td mat-cell *matCellDef="let row"> {{ row.accountHolderName }} </td>
          </ng-container>

          <!-- Account Type Column -->
          <ng-container matColumnDef="accountType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
            <td mat-cell *matCellDef="let row">
              <mat-chip-set>
                <mat-chip [color]="getAccountTypeColor(row.accountType)" highlighted>
                  {{ row.accountType }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Balance Column -->
          <ng-container matColumnDef="balance">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Balance </th>
            <td mat-cell *matCellDef="let row"> {{ row.balance | currency:'INR' }} </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
            <td mat-cell *matCellDef="let row">
              <mat-chip-set>
                <mat-chip [color]="getStatusColor(row.status)" highlighted>
                  {{ row.status }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Created Date Column -->
          <ng-container matColumnDef="createdDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Created Date </th>
            <td mat-cell *matCellDef="let row"> {{ row.createdDate | date:'mediumDate' }} </td>
          </ng-container>

          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let row">
              <button 
                mat-icon-button 
                color="primary" 
                (click)="viewAccountDetails(row.id)"
                matTooltip="View Details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button 
                mat-icon-button 
                color="accent" 
                (click)="closeAccount(row)"
                [disabled]="!isAccountActive(row.status)"
                matTooltip="Close Account">
                <mat-icon>close</mat-icon>
              </button>
            </td>
          </ng-container>
      
          <tr style="background-color: #3f51b5; color: white;" mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" style="cursor: pointer;" (click)="viewAccountDetails(row.id)"></tr>
      
          <!-- Row shown when there is no matching data -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="7" style="text-align: center; padding: 40px;">
              @if (input.value) {
                <p>No accounts found matching "{{ input.value }}"</p>
              } @else {
                <mat-icon style="font-size: 48px; height: 48px; width: 48px; color: #ccc;">account_balance</mat-icon>
                <p>No accounts available. Create your first account!</p>
                <button mat-raised-button color="primary" (click)="createAccount()">
                  <mat-icon>add</mat-icon>
                  Create Account
                </button>
              }
            </td>
          </tr>
        </table>
      
        <mat-paginator 
          [pageSizeOptions]="[5, 10, 25, 50]" 
          showFirstLastButtons
          aria-label="Select page of accounts">
        </mat-paginator>
      </div>
    }
  </mat-card-content>
</mat-card>